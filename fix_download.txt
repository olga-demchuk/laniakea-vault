  const hashtags = extractHashtags(caption);
  try {
    const file = await bot.getFile(photo.file_id);
    const fileName = `img_${Date.now()}.jpg`;
    const filePath = path.join('media/images', fileName);
    
    // Download and rename
    const downloadPath = await bot.downloadFile(file.file_id, 'media/images');
    fs.renameSync(downloadPath, filePath);
    
    db.run(
      'INSERT INTO data (type, file_path, note) VALUES (?, ?, ?)',
      ['image', `images/${fileName}`, caption],
      function(err) {
        if (err) {
          bot.sendMessage(chatId, 'âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ Ğ² Ğ‘Ğ”');
          console.error(err);
        } else {
          const dataId = this.lastID;
          saveThemes(dataId, hashtags, () => {
            const themesText = hashtags.length > 0 ? `\nğŸ·ï¸ Ğ¢ĞµĞ¼Ñ‹: ${hashtags.join(', ')}` : '';
            bot.sendMessage(chatId, `âœ… Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾!\n\nğŸ“· ID: ${dataId}\nğŸ“ ${caption}${themesText}`);
          });
        }
      }
    );
  } catch (err) {
    bot.sendMessage(chatId, 'âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ñ„Ğ¾Ñ‚Ğ¾');
    console.error(err);
  }
